---
platform: darwin
image: docker:///cloudfoundry/cli-ci

inputs:
  - name: cf-cli
    path: gopath/src/github.com/cloudfoundry/cli
  - name: version

run:
  path: bash
  args:
  - -c
  - |
    set -e -x

    export VERSION=$(cat version/number)

    export GOPATH=$PWD/gopath
    export PATH=$GOPATH/bin:$PATH

    pushd $GOPATH/src/github.com/cloudfoundry/cli
      bin/test
    popd

    mv $GOPATH/src/github.com/cloudfoundry/cli/out/cf ./cf-darwin64-$VERSION
